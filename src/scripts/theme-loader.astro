---
// eslint-disable-next-line no-undef
function getInitialTheme(window: Window): 'light' | 'dark' {
  const theme = window.document.cookie
    .split(';')
    .find((text) => text.trim().startsWith('theme='))
    ?.split('=')?.[1];
  if (theme === 'light' || theme === 'dark') {
    return theme; // User preference
  }
  return 'dark'; // Default theme
}
function minifyJavaScript(snippet: string): string {
  // Generated by ChatGPT. See: https://chat.openai.com/share/9e677c6b-daa6-4dde-b989-f9901758300e
  return (
    snippet
      // Remove comments (single-line and multi-line)
      .replace(/\/\/.*|\/\*[\s\S]*?\*\//g, '')
      // Remove line breaks and multiple whitespaces
      .replace(/\s+/g, ' ')
      // Remove whitespaces around symbols
      .replace(
        /\s*([{}()[\].,;:+\-*/%&|^!=<>?~]|==|===|!=|!==|\+=|-=|\*=|\/=|%==|&&|\|\||<<|>>|>>>)\s*/g,
        '$1',
      )
  );
}
---

<script
  set:html={minifyJavaScript(
    `document.documentElement.setAttribute("data-theme",(${getInitialTheme.toString()})(window))`,
  )}
/>
<script>
  import Cookies from 'js-cookie';
  import { themeCookieOptions } from 'src/constants/theme';
  import { isValidTheme } from 'src/utils/theme';

  const currentTheme = document.documentElement.getAttribute('data-theme');
  if (isValidTheme(currentTheme)) {
    Cookies.set('theme', currentTheme, {
      ...themeCookieOptions,
      expires: 180, // Days
    });
  }
</script>
