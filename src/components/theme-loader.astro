---
// eslint-disable-next-line no-undef
function getInitialTheme(window: Window): 'light' | 'dark' {
  // User preference
  const preference = window.document.cookie
    .split(';')
    .find((text) => text.trim().startsWith('theme='))
    ?.split('=')?.[1];
  if (preference === 'light' || preference === 'dark') {
    return preference;
  }
  // System preference
  const mediaQueryList = window.matchMedia('(prefers-color-scheme: dark)');
  if (typeof mediaQueryList.matches === 'boolean') {
    return mediaQueryList.matches ? 'dark' : 'light';
  }
  // Default theme
  return 'light';
}
function minifyJavaScript(snippet: string): string {
  // Generated by ChatGPT. See: https://chat.openai.com/share/9e677c6b-daa6-4dde-b989-f9901758300e
  return (
    snippet
      // Remove comments (single-line and multi-line)
      .replace(/\/\/.*|\/\*[\s\S]*?\*\//g, '')
      // Remove line breaks and multiple whitespaces
      .replace(/\s+/g, ' ')
      // Remove whitespaces around symbols
      .replace(
        /\s*([{}()[\].,;:+\-*/%&|^!=<>?~]|==|===|!=|!==|\+=|-=|\*=|\/=|%==|&&|\|\||<<|>>|>>>)\s*/g,
        '$1',
      )
  );
}
---

<script
  set:html={minifyJavaScript(
    `document.documentElement.setAttribute("data-theme",(${getInitialTheme.toString()})(window))`,
  )}
/>
