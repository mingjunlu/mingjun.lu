---
import { Icon } from 'astro-icon/components';
import { increasePostView } from 'src/utils/post';

function formatViewCount(count: number): string {
  const formatter = new Intl.NumberFormat('en-US', {
    notation: 'compact',
  });
  return formatter.format(count);
}

type Props = {
  viewCount?: number;
};

const { slug } = Astro.params;
const viewCount = Astro.props.viewCount ?? (await increasePostView(slug));
---

<div class="post-view-counter">
  <Icon name="fa6-solid:eye" />
  <span>{formatViewCount(viewCount)}</span>
</div>

<style lang="scss">
  @import '../styles/variables.scss';

  div {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  svg {
    flex: 0 0 auto;
    width: 16px;
    height: 16px;
  }
</style>
